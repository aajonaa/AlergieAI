<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Local LLM Chat</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; }
        #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; }
        #input { width: 100%; padding: 10px; }
        button { padding: 10px; }
    </style>
</head>
<body>
    <h1>Chat with Your Local Model</h1>
    <div id="chat"></div>
    <textarea id="input" placeholder="Type your message..."></textarea>
    <button onclick="sendMessage()">Send</button>

    <script>
        const apiUrl = 'http://localhost:8000/v1/chat/completions'; // Change to NewAPI if using it (e.g., :3000)
        const chatDiv = document.getElementById('chat');
        const input = document.getElementById('input');

        let conversation = []; // Track history for context

        async function sendMessage() {
            const prompt = input.value.trim();
            if (!prompt) return;

            // Display user message
            appendMessage('You: ' + prompt);
            input.value = '';

            // Add to conversation history
            conversation.push({ role: 'user', content: prompt });

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'your-model-name', // e.g., 'gpt-3.5-turbo' or whatever your local model is named
                        messages: conversation,
                        stream: true // Enable streaming for real-time responses
                    })
                });

                if (!response.ok) throw new Error('API error');

                const reader = response.body.getReader();
                let assistantMessage = 'Assistant: ';
                appendMessage(assistantMessage, true); // Placeholder for streaming

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = new TextDecoder().decode(value);
                    const lines = chunk.split('\n');
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;
                            try {
                                const parsed = JSON.parse(data);
                                const delta = parsed.choices[0].delta.content;
                                if (delta) {
                                    assistantMessage += delta;
                                    updateLastMessage(assistantMessage);
                                }
                            } catch (e) {}
                        }
                    }
                }

                // Add assistant's full response to history
                conversation.push({ role: 'assistant', content: assistantMessage.replace('Assistant: ', '') });
            } catch (error) {
                appendMessage('Error: ' + error.message);
            }
        }

        function appendMessage(text, isPartial = false) {
            const p = document.createElement('p');
            p.textContent = text;
            chatDiv.appendChild(p);
            chatDiv.scrollTop = chatDiv.scrollHeight;
            if (isPartial) p.id = 'partial'; // For updating streaming message
        }

        function updateLastMessage(text) {
            const partial = document.getElementById('partial');
            if (partial) partial.textContent = text;
        }
    </script>
</body>
</html>